$(document).ready(function(){var a=$.cookie("load");if(a){a=JSON.parse(a);cartData=a.cartData;totalPrice=a.totalPrice;totalNum=a.totalNum;$("#shopcart-tip").show();$("#shopcart-tip").html(totalNum);if(totalNum==0){$("#shopcart-tip").hide()}}Path.map("#/index").to(function(){$(".navigation-wrap").show();$("#nav-ads").click();var c=new Swiper(".swiper-container",{pagination:".swiper-pagination",autoplay:5000});var b="<script src= '"+data.jsUrl+"/wechatShare.js' />";$("#wechatShareJS").html(b)});Path.map("#/product").to(function(){$("#nav-product").click();var b="<script src= '"+data.jsUrl+"/wechatShare.js' />";$("#wechatShareJS").html(b)});Path.map("#/product/:id").to(function(){var b=this.params.id;clickItemDetail(b)});Path.map("#/cart").to(function(){$("#nav-cart").click();var b="<script src= '"+data.jsUrl+"/wechatShare.js' />";$("#wechatShareJS").html(b)});Path.map("#/order/:id").to(function(){var b=this.params.id;displayOrderResult(b)});Path.map("#/user").to(function(){$("#nav-user").click();var b="<script src= '"+data.jsUrl+"/wechatShare.js' />";$("#wechatShareJS").html(b)});Path.map("#/selectShop").to(function(){selectShop();var b="<script src= '"+data.jsUrl+"/wechatShare.js' />";$("#wechatShareJS").html(b)});Path.map("#/showShopInfo").to(function(){showShopInfo();var b="<script src= '"+data.jsUrl+"/wechatShare.js' />";$("#wechatShareJS").html(b)});Path.root("#/index");Path.listen()});var lng="";var lat="";function locationmy(){var a=document.createElement("script");a.type="text/javascript";a.src="http://restapi.amap.com/v3/geocode/regeo?output=json&location="+lng+","+lat+"&key=22f9022b217b7d764f5befb4aa74456f&radius=1000&extensions=all&callback=renderOption";document.head.appendChild(a)}function renderOption(a){document.getElementById("pi_address").innerHTML=a.regeocode.formatted_address}var appIdo="";var timestampo="";var nonceStro="";var signatureo="";wx.config({debug:false,appId:data.wxConfig.appId,timestamp:data.wxConfig.timestamp,nonceStr:data.wxConfig.nonceStr,signature:data.wxConfig.signature,jsApiList:["getLocation"]});function selectShop(){tabTmpl("select-shop");$(".navigation-wrap").hide();var a=data.config.id;if(a!=0&&a!=undefined&&a!=""){$("#pi_back").show()}else{$("#pi_back").hide()}wx.getLocation({type:"wgs84",success:function(b){lat=b.latitude;lng=b.longitude;var c=b.speed;var d=b.accuracy;locationmy();shopList()}})}function showShopInfo(){tabTmpl("show-shopinfo")}function shopList(){alert(11111111111);$.ajax({type:"post",url:data.baseUrl+"/General/Biz/getShopList",data:{lng:lng,lat:lat},success:function(c){var b={shopes:c,uploadsUrl:data.uploadsUrl,imageUrl:data.imageUrl};var a=template("shopItems",b);$("#mod-desc").html(a)},beforeSend:function(){$("#page_tag_load").show()},complete:function(){$("#page_tag_load").hide()}})}function searchShop(){var a=$(".pi_input").val();var b=$("#searchContentType").val();$.ajax({type:"post",url:data.baseUrl+"/General/Biz/getShopList",data:{name:a,searchContentType:b,lng:lng,lat:lat},success:function(e){var d={shopes:e,jsData:data,uploadsUrl:data.uploadsUrl,imageUrl:data.imageUrl};var c="";if(b=="shop"){c=template("shopItems",d)}else{c=template("shopItemsWithProduct",d)}$("#mod-desc").html(c)},beforeSend:function(){$("#page_tag_load").show()},complete:function(){$("#page_tag_load").hide()}})}function openTHisShop(a){window.location.href=data.baseUrl+"/App/Index/index/shopId/"+a;initShop(a)}function setShopID(a){set("shopId",a)}function initShop(a){set("shopId",a);cartData=[];totalNum=0;totalPrice=0;payment=-1;initProduct()}function set(a,b){return window.localStorage.setItem(a,window.JSON.stringify(b))}function get(a){return window.JSON.parse(window.localStorage.getItem(a))}function remove(a){return window.localStorage.removeItem(a)}function backToTop(){$("html,body").animate({scrollTop:0},200)}function displayOrderResult(id){$.ajax({type:"get",url:data.baseUrl+"/App/Order/getOrder",data:{id:id},success:function(data){$("#nav-cart").click();tabTmpl("orderResult-container");$(".header-title").html("支付结果");$("#result-order-no").html(data.orderid);$("#items-order-result").find(".date").html(data.time);$("#items-order-result").find(".freight").html(data.freight);if(data.totalprice>=data.full){$("#items-order-result").find(".discount").html(data.discount)}$("#items-order-result").find(".total").children().html(data.totalprice);if(data.pay_status==1){$("#status").html("支付成功")}else{$("#status").html("未支付")}var json=eval(data.detail);var html="";$.each(json,function(index,value){var sku="";if(parseInt(value.sku_id)){sku="（"+value.sku_name+"）"}html+='<li><span class="order-item-name">'+value.name+sku+'</span><span class="order-item-price">￥'+value.price+'</span><span class="order-item-amount">'+value.num+"份</span></li>"});$("#item-order-list ul").html(html)},beforeSend:function(){$("#page_tag_load").show()},complete:function(){$("#page_tag_load").hide()}})}var menuId=0;function changeMenu(f,g,a){$(".menuItem").removeClass("active");$(f).addClass("active");menuId=g;if(a=="toggle"){$("#types-dropdown").toggle();var d=$(f).html();var c=$(f).attr("onclick");var b=$("#more-types").html();var e=$("#more-types").attr("onclick");$("#more-types").html(d);$("#more-types").attr("onclick",c);$(f).html(b);$(f).attr("onclick",e);$("#more-types").addClass("active")}$.each($("#items").children(),function(h,i){if($(this).attr("label-cate")==g){$(this).show()}else{$(this).hide()}});if($("#notification").length){$("#notification").show()}backToTop()}function doCart(f,g,b,c,e){if($("#itemsDetail").length>0){if(e==""){var a=0;$.each(cartData,function(h,i){if(i.id==g){a=1;i.num++;return}});if(a==0){var d='{"id":"'+g+'","name":"'+b+'","num":"'+1+'","price":"'+c+'"}';cartData.push(JSON.parse(d))}}else{if(sku.product_id!=g){alert("error");return}var a=0;$.each(cartData,function(h,i){if(i.id==g&&i.sku_id==sku.sku_id){a=1;i.num++;return}});if(a==0){var d='{"id":"'+g+'","name":"'+b+'","num":"'+1+'","price":"'+sku.price+'","sku_name":"'+sku.sku_name+'","sku_id":"'+sku.sku_id+'"}';cartData.push(JSON.parse(d))}}initProduct();return}else{var a=0;$.each(cartData,function(h,i){if(i.id==g){a=1;i.num++;return}});if(a==0){var d='{"id":"'+g+'","name":"'+b+'","num":"'+1+'","price":"'+c+'"}';cartData.push(JSON.parse(d))}initProduct();return}}function initProduct(){$.each($("#items").children(),function(a,b){$(this).find(".numbers-minus").hide();$(this).find(".numbers").hide();$(this).find(".numbers").val(0)});$.each(cartData,function(a,b){$("#items").find('li[label-id="'+b.id+'"]').find(".numbers-minus").show();$("#items").find('li[label-id="'+b.id+'"]').find(".numbers").show();$("#items").find('li[label-id="'+b.id+'"]').find(".numbers").val(b.num);$("#product-hot").find('li[label-id="'+b.id+'"]').find(".numbers-minus").show();$("#product-hot").find('li[label-id="'+b.id+'"]').find(".numbers").show();$("#product-hot").find('li[label-id="'+b.id+'"]').find(".numbers").val(b.num)});initCartDate()}function initCartDate(){totalNum=0;totalPrice=0;$.each(cartData,function(b,c){totalNum+=parseInt(c.num);totalPrice+=parseFloat(c.price)*c.num});totalPrice=(parseFloat(totalPrice)+parseFloat(data.config.freight)).toFixed(2);if(totalPrice>parseFloat(data.config.full)){totalPrice=(totalPrice-parseFloat(data.config.discount)).toFixed(2)}$("#shopcart-tip").show();$("#shopcart-sure").show();$("#shopcart-tip").html(totalNum);$("#shopcart-totalPrice").html(totalPrice);if(totalNum==0){$("#shopcart-tip").hide();$("#shopcart-sure").hide();$("#shopcart-totalPrice").html(0)}var a={cartData:cartData,totalPrice:totalPrice,totalNum:totalNum};$.cookie("load",JSON.stringify(a),{path:"/"})}function clickItemDetail(id){tabTmpl("itemsDetail-container");backContainer="product-container";if(totalNum!=0){$("#shopcart-tip").show();$("#shopcart-tip").html(totalNum)}$.ajax({type:"get",url:data.baseUrl+"/App/Shop/getProduct",data:{id:id},success:function(res){var json=eval(res);$("#itemsDetail .single-name").html(json.name);$("#itemsDetail .new-price").children().html(json.price);$("#itemsDetail .detail-label").html(json.label);$("#itemsDetail .detail-title").next().html(json.detail);$("#itemsDetail .detail-score").children().html(json.score);$("#itemsDetail #sale-unit").html(json.unit);$("#itemsDetail #detail-id").val(json.id);$("#itemsDetail #productMainImage").val(data.uploadsUrl+json.savepath+json.savename);$("#itemsDetail .addItem.btn-shopping").attr("onclick","doCart(this ,"+json.id+",'"+json.name+"',"+json.price+",'')");$("#product-attr").hide();if(json.status==1){$("#itemsDetail #addCartBtn").show();$("#itemsDetail .addItem.btn-shopping").attr("onclick","doCart(this ,"+json.id+",'"+json.name+"',"+json.price+","+json.sku.length+")")}else{$("#itemsDetail #soldOut").show()}if(json.sku.length){var html="";$.each(json.sku,function(index,value){html+='<p class="attr-btn" onclick="addAttr(this , '+json.id+" ,"+value.id+" , '"+value.name+"', '"+value.price+"')\">"+value.name+"</p>"});$("#itemsDetail #detail-attr-btn").html(html);$("#product-attr").show()}if(json.albums==""){var topimage=[];topimage.push(JSON.parse('{"savename":"'+json.savename+'","savepath":"'+json.savepath+'"}'));json.albums=topimage}var html="";$.each(json.albums,function(index,value){html+='<div class="swiper-slide" style="text-align: -webkit-center;"><img style="height: 200px" src="'+data.uploadsUrl+value.savepath+value.savename+'"></div>'});$("#itemsDetail .swiper-wrapper").html(html);initCartDate();$("#items-total-price").html(totalPrice);if(res.comment!=null){json=eval(res.comment);var html="";$.each(json,function(index,value){html+='<li><span class="commit_left">'+value.user_name+'</span><span class="commit_right">'+value.name+"</span></li>"});$("#commentList").html(html)}else{$("#commentList").html("")}var html="<script src= '"+data.jsUrl+"/wechatShare.js' />";$("#wechatShareJS").html(html)},beforeSend:function(){$("#page_tag_load").show()},complete:function(){$("#page_tag_load").hide();var mySwiper=new Swiper(".swiper-container",{direction:"horizontal",loop:true,pagination:".swiper-pagination",scrollbar:".swiper-scrollbar"});$(".attr-btn").first().click()}})}var sku={};function addAttr(obj,product_id,sku_id,sku_name,price){$(".attr-btn").css("background-color","#ffffff");$(".attr-btn").css("color","#000000");$(obj).css("background-color","#FF4146");$(obj).css("color","#ffffff");$(".new-price").children().html(price);sku.product_id=product_id;sku.sku_name=sku_name;sku.sku_id=sku_id;sku.price=price;$.ajax({type:"get",url:data.baseUrl+"/App/Shop/getSku",data:{id:sku_id},success:function(res){var json=eval(res);var imgSrc="";if(json.savename){imgSrc=data.uploadsUrl+json.savepath+json.savename;var html='<img class="detail-image contentCenter" style="height:200px" src="'+imgSrc+'">';$("#itemsDetail .detail-image-container").html(html)}else{$("#itemsDetail .detail-image-container").html("")}}})}function addproductNum(b,d,a){var c=0;$.each(cartData,function(e,f){if(a==0){if(f.id==d){c=f.num;f.num++;if(c==1){$(b).prev().prev().removeClass("disabled")}}}else{if(f.id==d&&f.sku_id==a){c=f.num;f.num++;if(c==1){$(b).prev().prev().removeClass("disabled")}}}});c++;$(b).prev().val(c);$(b).parent().prev().find(".item-amount").html(c);initCartDate();$("#items-total-price").html(totalPrice)}function reducehotproductNum(b,d,a){var c=0;$.each(cartData,function(e,f){if(a==0){if(f.id==d){c=f.num;f.num--;if(f.num==0){cartData.splice(e,1);initProduct();$("#items-total-price").html(totalPrice);$("#product-hot").find('li[label-id="'+f.id+'"]').find(".numbers-minus").hide();$("#product-hot").find('li[label-id="'+f.id+'"]').find(".numbers").hide();$("#item").find('li[label-id="'+f.id+'"]').find(".numbers-minus").hide();$("#item").find('li[label-id="'+f.id+'"]').find(".numbers").hide();return}if(c==1){$(b).addClass("disabled")}}}else{if(f.id==d&&f.sku_id==a){c=f.num;f.num--;if(f.num==0){cartData.splice(e,1);initProduct();$("#items-total-price").html(totalPrice);$("#product-hot").find('li[label-id="'+f.id+'"]').find(".numbers-minus").hide();$("#product-hot").find('li[label-id="'+f.id+'"]').find(".numbers").hide();$("#item").find('li[label-id="'+f.id+'"]').find(".numbers-minus").hide();$("#item").find('li[label-id="'+f.id+'"]').find(".numbers").hide();return}if(c==1){$(b).addClass("disabled")}}}});c--;$(b).next().val(c);$(b).parent().prev().find(".item-amount").html(c);initCartDate();$("#items-total-price").html(totalPrice)}function reduceproductNum(b,d,a){var c=0;$.each(cartData,function(e,f){if(a==0){if(f.id==d){c=f.num;f.num--;if(f.num==0){cartData.splice(e,1);$(b).parent().parent().parent().remove();initProduct();$("#items-total-price").html(totalPrice);if(cartData.length==0){$("#nav-product").click()}return}if(c==1){$(b).addClass("disabled")}}}else{if(f.id==d&&f.sku_id==a){c=f.num;f.num--;if(f.num==0){cartData.splice(e,1);$(b).parent().parent().parent().remove();initProduct();$("#items-total-price").html(totalPrice);if(cartData.length==0){$("#nav-product").click()}return}if(c==1){$(b).addClass("disabled")}}}});c--;$(b).next().val(c);$(b).parent().prev().find(".item-amount").html(c);initCartDate();$("#items-total-price").html(totalPrice)}function deleteProduct(b,c,a){$.each(cartData,function(d,e){if(a==0){if(e.id==c){cartData.splice(d,1);$(b).parent().parent().parent().remove();initProduct();$("#items-total-price").html(totalPrice);if(cartData.length==0){$("#nav-product").click()}return}}else{if(e.id==c&&e.sku_id==a){cartData.splice(d,1);$(b).parent().parent().parent().remove();initProduct();$("#items-total-price").html(totalPrice);if(cartData.length==0){$("#nav-product").click()}return}}})}function cartNext(){if(cartData.length==0){return}tabTmpl("delivery-container");backContainer="cart-container";$(".header-left").show();$("#balance-payment").click(function(){$(".payment-content").find(".radio").removeClass("selected");$(this).find(".radio").addClass("selected");payment=0});$("#wechat-payment").click(function(){$(".payment-content").find(".radio").removeClass("selected");$(this).find(".radio").addClass("selected");payment=1});$("#alipay-payment").click(function(){$(".payment-content").find(".radio").removeClass("selected");$(this).find(".radio").addClass("selected");payment=2});$("#cool-payment").click(function(){$(".payment-content").find(".radio").removeClass("selected");$(this).find(".radio").addClass("selected");payment=3});$.ajax({type:"get",url:data.baseUrl+"/App/User/getContactList",data:{getProvince:true},success:function(res){if(res){if(res.code==0){openLogin();return}if(res.province!=[]){var html="";var city=eval(res.province);if(city!=null){$.each(city,function(index,value){html+='<option value="'+value.name+'" label="'+index+'">'+value.name+"</option>"});$("#hat_city").html(html)}var html="";if(city[0]["city"]!=null){$.each(city[0]["city"],function(index,value){html+='<option value="'+value.name+'">'+value.name+"</option>"});$("#hat_area").html(html)}area=res.province}var html="";var deliveryTime=eval(data.config.delivery_time);$.each(deliveryTime,function(index,value){html+='<option value="'+value+'">'+value+"</option>"});$("#deliveryTime").html(html);if(res[0]!=null){$("#username").val(res[0].name);$("#tel").val(res[0].phone);$("#id").val(res[0].id);$("#hat_city").val(res[0].city);$("#address").val(res[0].address);var label=$("#hat_city").find("option:selected").attr("label");if(label){var html="";$.each(city[label]["city"],function(index,value){html+='<option value="'+value.name+'">'+value.name+"</option>";$("#hat_area").html(html)})}$("#hat_area").val(res[0].city)}}},beforeSend:function(){$("#page_tag_load").show()},complete:function(){$("#page_tag_load").hide()}})}var submitFlag=true;function submitOrder(){if(submitFlag==false){alert("请不要重复操作!");return}var name=$("#username").val();var id=$("#id").val();var phone=$("#tel").val();var province=$("#hat_city").val();var city=$("#hat_area").val();var address=$("#address").val();var note=$("#note").val();var deliveryTime=$("#deliveryTime").val();var shopId=get("shopId");var freights=data.config.freight;var contact={id:id,name:name,phone:phone,province:province,city:city,address:address};if(totalPrice>=data.config.full){var discount=data.config.discount}else{var discount=0}var order={shop_id:shopId,remark:note,delivery_time:deliveryTime,totalprice:totalPrice,freight:freights,payment:payment,discount:discount};if(payment==-1){alert("请选择支付方式!");return}if(name.length==0||phone.length==0||address.length==0){alert("请核对输入的信息!");return}submitFlag=false;$.ajax({type:"post",url:data.baseUrl+"/App/Order/addOrder",data:{contact:contact,cartData:cartData,order:order},success:function(res){if(res){tabTmpl("orderResult-container");console.log(eval(res));$("#result-order-no").html(res.orderid);$("#items-order-result").find(".date").html(res.time);$("#items-order-result").find(".total").children().html(res.totalprice);$(".freight").html(res.freight);$(".discount").html(res.discount);if(res.pay_status==1){$("#status").html("支付成功")}else{$("#status").html("未支付")}var json=eval(res.detail);var html="";$.each(json,function(index,value){var sku="";if(parseInt(value.sku_id)){sku="（"+value.sku_name+"）"}html+='<li><span class="order-item-name">'+value.name+sku+'</span><span class="order-item-price">￥'+value.price+'</span><span class="order-item-amount">'+value.num+"份</span></li>"});$("#item-order-list ul").html(html);cartData=[];totalNum=0;totalPrice=0;payment=-1;initProduct();if(typeof res.payUrl!="undefined"){if(res.payUrlMent!=1){layer.open({content:"请稍后,正在打开在线支付...",style:"border-radius: 3px;text-align: center;border:0;"});window.location.href=res.payUrl}else{var html=template("qrcodePay-container",{qrcode:res.payUrl});$("#orderResult").append(html)}}}else{alert("提交失败!余额不足或者商品已下架,请重新选购!")}},beforeSend:function(){$("#page_tag_load").show();backToTop()},complete:function(){$("#page_tag_load").hide();submitFlag=true}})}function empty(a){$("#"+a).val("")}function changeCity(c){var a=$(c).find("option:selected").attr("label");$("#hat_area").html("");var b="";$.each(area[a]["city"],function(d,e){b+='<option value="'+e.name+'">'+e.name+"</option>";$("#hat_area").html(b)})}function cancelOrder(a){$("#orderCancel-popup").show();$("#yesOrder").one("click",function(){$.ajax({type:"get",url:data.baseUrl+"/App/Order/updateOrder",data:{id:a},success:function(b){$("#nav-user").click();$("#orderCancel-popup").hide()},beforeSend:function(){$("#page_tag_load").show()},complete:function(){$("#page_tag_load").hide()}})});$("#noOrder").one("click",function(){$("#orderCancel-popup").hide()})}function commentOrder(a){$("#orderComment-popup").show();$("#yesCommit").one("click",function(){if($("#comment-text").val().length==0){alert("请核对输入的信息!");return}$.ajax({type:"post",url:data.baseUrl+"/App/Order/commentOrder",data:{name:$("#comment-text").val(),id:a},success:function(b){$("#orderComment-popup").hide();alert(b.msg)},beforeSend:function(){$("#page_tag_load").show()},complete:function(){$("#page_tag_load").hide()}});$("#orderComment-popup").hide();$("#comment-text").val("")});$("#noCommit").one("click",function(){$("#orderComment-popup").hide();$("#comment-text").val("")})}function openLogin(){tabTmpl("login-container");$(".header-title").html("登录");$(".header-left").show();backContainer="user-container"}function openRegister(){tabTmpl("register-container");$(".header-title").html("注册");$(".header-left").show();backContainer="user-container"}function openForgetPassword(){tabTmpl("forgetPassword-container");$(".header-title").html("忘记密码");$(".header-left").show();backContainer="login-container"}function login(){var a=$("#loginPhone").val();var b=$("#loginPassword").val();if(a.length==0||b.length==0){alert("请核对输入的信息!");return}$.ajax({type:"post",url:data.baseUrl+"/App/User/login",data:{phone:a,password:b},success:function(c){if(c){data.username=c.username;data.avater=c.image;$("#nav-user").click()}else{alert("登录失败!")}},beforeSend:function(){$("#page_tag_load").show()},complete:function(){$("#page_tag_load").hide()}})}function register(){var d=$("#registerUsername").val();var a=$("#registerPhone").val();var b=$("#registerPassword").val();var c=$("#registerPassword2").val();if(b!=c){alert("两次输入密码不相同!");return}if(a.length==0||b.length==0){alert("请核对输入的信息!");return}$.ajax({type:"post",url:data.baseUrl+"/App/User/register",data:{phone:a,password:b,username:d},success:function(e){if(e){$("#nav-user").click()}else{alert("注册失败!")}},beforeSend:function(){$("#page_tag_load").show()},complete:function(){$("#page_tag_load").hide()}})}function resetPassword(){var c=$("#forgetUsername").val();var a=$("#forgetPhone").val();var b=$("#forgetPassword").val();if(c.length==0||a.length==0||b.length==0){alert("请核对输入的信息!");return}$.ajax({type:"post",url:data.baseUrl+"/App/User/resetPassword",data:{username:c,phone:a,password:b},success:function(d){if(d){alert("密码修改成功,请使用新密码登录!");tabTmpl("login-container");$(".header-title").html("注册")}else{alert("密码修改失败!")}$("#orderComment-popup").hide()},beforeSend:function(){$("#page_tag_load").show()},complete:function(){$("#page_tag_load").hide()}})}function payOrder(b,a){if(b==1){window.location.href=data.baseUrl+"/App/Pay/wxPay/id/"+a}else{window.location.href=data.baseUrl+"/App/Pay/alipay/id/"+a}}function navSelect(a){$(".navigation-item").removeClass("selected");$(".navigation-item").children().removeClass("selected");$(a).addClass("selected");$(a).children().addClass("selected")}function openAds(a){navSelect(a);$("#shopcart-tip").show();$("#shopcart-tip").html(totalNum);tabTmpl("ads-container");initProduct();$(".header-title").html(data.config.name)}function tabTmpl(b){var a=template(b,data);$("#main").html(a);$(".header-left").hide();echo.init({offset:100,throttle:250,unload:false,callback:function(c,d){}});backToTop();menuId=0}function openProduct(d){navSelect(d);$("#shopcart-tip").hide();var c=template("product-container",data);$("#main").html(c);echo.init({offset:100,throttle:250,unload:false,callback:function(f,g){}});initProduct();var a=get("lastSelectedMenuID");var e=get("lastSelectedOfShopID");if(a&&e==data.shopId){switchMenu(null,a,false)}else{$(".shop-menu li").first().click()}var b=new Swiper("#swiper-container",{slidesPerView:3,spaceBetween:0})}function openCartsure(){$("#nav-cart").click()}function openCart(b){navSelect(b);tabTmpl("cart-container");$("#shopcart-tip").show();$("#shopcart-tip").html(totalNum);if(totalNum==0){$("#shopcart-tip").hide()}var a="";$.each(cartData,function(c,e){var f="";var d=0;if(e.sku_id){f="（"+e.sku_name+"）";d=e.sku_id}a+='<li><div class="confirmation-item"><div class="item-info"><span class="item-name">'+e.name+f+'<br></span><span class="item-price-info"><span><span class="item-single-price">'+e.price+'</span>×<span class="item-amount">'+e.num+'</span></span></span></div><div class="select-box"><span class="minus disabled" onclick="reduceproductNum(this,'+e.id+","+d+')">—</span><input class="amount" type="text" name="amount" value="'+e.num+'" autocomplete="off" readonly=""><span class="add" onclick="addproductNum(this,'+e.id+","+d+')">+</span></div><div class="delete"><a class="delete-btn" onclick="deleteProduct(this,'+e.id+","+d+')"><i class="ico ico-delete"></i></a></div></div><div class="divider"></div></li>'});$("#item-list ul").html(a);$("#items-total-price").html(totalPrice)}function openUser(o){navSelect(o);if(totalNum!=0){$("#shopcart-tip").show();$("#shopcart-tip").html(totalNum)}if(data.user.length==2){openLogin();return}tabTmpl("user-container");$.ajax({type:"get",url:data.baseUrl+"/App/User/getUser",data:{getOrder:true},success:function(res){$("#balance").html("");if(res){if(res.identity==1){$("#identity").html("管理员")}$("#balance").html(res.money+"元");$("#score").html(res.score+"分");$("#items-order-result-list ul").html("");$(".myOrderList").hide();if(res.order!=undefined){var json=eval(res.order);if(json.length!=0){$(".myOrderList").show();var dataSending={orders:json,jsData:data};var html=template("orderItems",dataSending);$("#items-order-result-list ul").html(html)}}}},beforeSend:function(){$("#page_tag_load").show()},complete:function(){$("#page_tag_load").hide()}})}function backToSale(){window.location.reload()}jQuery.fn.shake=function(c,b,a){this.stop().each(function(){var e=$(this);var f=parseInt(e.css("margin-left"));var d=d>20?d:20;e.animate({"margin-left":f+b},d,function(){e.animate({"margin-left":f},d,function(){c=c-1;if(c>0){e.shake(c,b,d)}})})});return this};var backContainer="";function headerBack(){if(backContainer!=""){switch(backContainer){case"product-container":$("#nav-product").click();backContainer="";break;case"cart-container":$("#nav-cart").click();backContainer="";break;case"user-container":$("#nav-user").click();backContainer="";break;case"login-container":openLogin();break}}}var menuId=0;function switchMenu(b,c,a){if(!b){b=$("#menu_li_"+c)}$(b).removeClass("lia").addClass("lib").siblings().removeClass("lib").addClass("lia");$(".menu-name span").html($(b).html());menuId=c;$.ajax({type:"get",url:data.baseUrl+"/App/Index/getProducts",data:{menuId:c},success:function(g){var h=g;var f={products:h,uploadsUrl:data.uploadsUrl,imageUrl:data.imageUrl};var e=template("productItems",f);$("#productInfoItems").html(e);echo.init({offset:100,throttle:250,unload:false,callback:function(i,j){}});if(a==true){backToTop()}else{var d=get("scrollPositionOfProductPage");if(d){$(document).animate({scrollTop:d},200)}else{backToTop()}}},error:function(){alert("网络异常，请稍后再试！")},beforeSend:function(){},complete:function(){}});set("lastSelectedMenuID",c);set("lastSelectedOfShopID",data.shopId)}function prevView(a){var b=$(a).attr("src");layer.open({content:'<img style="width: 200px" src="'+b+'"/>'})}function openSearch(){var a=$("input[name = 'searchtxt']").val();if(!a){layer.open({content:"请输入要查询的产品名称！"})}else{$.ajax({type:"get",url:data.baseUrl+"/App/Index/searchProducts",data:{keyword:a,shopId:data.shopId},success:function(d){if(d){var e=d;var c={products:e,uploadsUrl:data.uploadsUrl,imageUrl:data.imageUrl};var b=template("productItems",c);$("#productInfoItems").html(b);$(".shop-menu .lib").removeClass("lib").addClass("lia");$(".shop-product li").hide().filter(':contains("'+a+'")').show()}else{layer.open({content:"没有搜到此商品"})}echo.init({offset:100,throttle:250,unload:false,callback:function(f,g){}});backToTop()},error:function(){alert("网络异常，请稍后再试！")},beforeSend:function(){},complete:function(){}})}};